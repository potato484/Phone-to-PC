
  ## 文件管理增强方案（复制路径 + 新建文件 + 根目录快捷 + 图标化工具栏）

  ### 摘要

  在现有文件管理模块（public/index.html + public/lib/files.js + public/style.css + src/routes/api.ts）实现 4
  项能力：

  1. 长按文件/目录增加“复制相对路径”和“复制绝对路径”。
  2. 工具栏新增“新建文件”。
  3. 工具栏新增“跳转根目录”快捷键（你指定为系统根 /；在当前后端语义下会映射到工作区根）。
  4. 文件工具栏改为“小图标按钮 + title/aria-label 提示”，点击即执行动作（含刷新）。

  ### 已确认的产品决策

  1. 复制路径支持“两种都支持”。
  2. 根目录快捷键目标为/。
  3. 工具栏样式为“仅图标+提示”。
  4. 绝对路径来源为“后端返回真实绝对路径”。

  ### 代码改动设计（决策完成）

  1. 后端 API 扩展：GET /api/fs/list 返回每个条目的 absPath。
  2. 前端数据模型：entries 项新增 absPath 字段（可选字符串）。
  3. 长按菜单新增两个动作按钮：

  - data-action="copy-path-rel"：复制相对路径（entry.path）。
  - data-action="copy-path-abs"：复制绝对路径（entry.absPath）。

  4. 新建文件按钮：

  - 新增 DOM 节点 #files-newfile-btn。
  - 点击后 prompt('新文件名称', 'new-file.txt')，目标路径 joinPath(currentPath, name)。
  - 通过 POST /api/fs/write 写入空内容 '' 创建文件。
  - 若当前目录已有同名条目，先二次确认覆盖，避免误覆盖。

  5. 根目录按钮：

  - 新增 DOM 节点 #files-root-btn。
  - 点击执行 refresh('/')，由后端 normalizeRelativeInput('/') => '.' 回到受控根目录。

  6. 图标化工具栏：

  - 将现有工具栏按钮文本替换为图标字符（如：⇧ 上级、⟳ 刷新、⌂ 根目录、📄+ 新文件、📁+ 新目录、⤴ 上传）。
  - 每个按钮保留 title 与 aria-label 中文语义，保证可访问性。
  - files-toolbar 栅格从 4 列调整为 6 列，移动端断点同步调整（如 3 列/2 行）。

  ### 公共接口/类型变化

  1. GET /api/fs/list 响应 entries[] 新增字段：

  - absPath: string，示例：/home/potato/computer-to-phone/src/routes/api.ts。

  2. 前端 entries 使用方（public/lib/files.js）按“可选字段”读取，避免旧缓存或异常返回导致崩溃。
  3. 不新增新路由；复用 POST /api/fs/write 完成新建文件。

  ### 测试与验收场景

  1. API 集成测试（新增到 tests/integration）：

  - 调用 /api/fs/list?path=.，断言 entries[*].absPath 存在且为绝对路径。
  - 断言 path='/' 时返回根路径 . 且 parent=null。

  2. 前端行为验证（可先手工，后续可补自动化）：

  - 长按文件：可见“复制相对路径/复制绝对路径”，复制成功 Toast 正确。
  - 长按目录：同样可复制两种路径。
  - 新建文件：输入新文件名后列表刷新且可打开编辑。
  - 同名新建时出现覆盖确认，取消后不改动。
  - 根目录图标点击后跳回根目录显示 .。
  - 刷新图标点击立即刷新列表，无需二次确认。

  - 键盘触发（Enter/Space）仍能执行对应动作。

  ### 风险与处理

  1. 暴露真实绝对路径会泄漏服务器目录结构。

  - 这是你已确认的实现方向，按需求执行。
  - 保持后端 resolvePathWithinBase 不变，仍不允许越界访问。

  2. navigator.clipboard 兼容性问题。

  - 沿用现有项目处理：不可用时 Toast 提示“当前环境不支持复制”。

  ### 假设与默认值

  1. “根目录”在当前系统中定义为文件管理受控根；即按钮传/并由后端映射到.。
  2. “新建文件”默认创建 UTF-8 空文本文件，不弹出编辑器，创建后刷新列表。
  3. 图标采用字符/emoji 方案，不引入第三方图标库，避免新增静态资源和打包成本。

## 实现补充（已完成）

### 1) 图标按钮增加小文字说明

- 文件管理工具栏改为“图标 + 小文字”上下排版，增强可读性。
- 每个按钮保留 `title` 与 `aria-label`，兼顾触控与无障碍。

### 2) 终端区提示文案移除

- 删除“提示：新版直接在终端面板内输入...”文案，减少界面冗余。

### 3) 手机端交互控件缩小

- 缩小“新建终端”按钮及会话列表按钮尺寸。
- 缩小快捷键按钮（高度/字号/间距/圆角），提升手机端密度。

### 4) CQS 增加中文注释

- 在监控面板中，将 `CQS` 增加旁注为“连接质量”，便于非英文用户理解。

### 5) 文件管理新增“隐藏文件显示”开关

- 新增工具栏按钮（`H-` / `H+`）用于切换显示隐藏文件。
- 默认显示隐藏文件；点击后隐藏以 `.` 开头的文件和目录，再点恢复显示。
- 当隐藏后列表为空时，显示“隐藏文件已关闭显示”提示。
- 按钮有激活态（高亮）用于表示当前“隐藏文件不显示”状态。
